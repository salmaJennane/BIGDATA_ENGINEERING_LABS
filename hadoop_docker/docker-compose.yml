version: '3.8'

services:
  # ===============================
  # Hadoop Master (NameNode)
  # ===============================
  hadoop-master:
    image: yassern1/hadoop-spark-jupyter:1.0.3
    container_name: hadoop-master
    hostname: hadoop-master
    networks:
      - hadoop
    ports:
      - "9870:9870"   # NameNode UI
      - "8088:8088"   # YARN ResourceManager UI
      - "7077:7077"   # Spark Master
      - "19888:19888" # MapReduce JobHistory Server
      - "8080:8080"   # Spark Master Web UI
      - "9000:9000"   # HDFS
      - "16010:16010" # HBase Master Web UI
      - "16030:16030" # HBase RegionServer Web UI
    volumes:
      - /c/Users/hp/OneDrive/Documents/hadoop_project:/shared_volume
    stdin_open: true
    tty: true
    command: tail -f /dev/null

  # ===============================
  # Hadoop Slave 1 (DataNode)
  # ===============================
  hadoop-slave1:
    image: yassern1/hadoop-spark-jupyter:1.0.3
    container_name: hadoop-slave1
    hostname: hadoop-slave1
    networks:
      - hadoop
    ports:
      - "8040:8042"   # NodeManager UI
    stdin_open: true
    tty: true
    command: tail -f /dev/null
    depends_on:
      - hadoop-master

  # ===============================
  # Hadoop Slave 2 (DataNode)
  # ===============================
  hadoop-slave2:
    image: yassern1/hadoop-spark-jupyter:1.0.3
    container_name: hadoop-slave2
    hostname: hadoop-slave2
    networks:
      - hadoop
    ports:
      - "8041:8042"   # NodeManager UI
    stdin_open: true
    tty: true
    command: tail -f /dev/null
    depends_on:
      - hadoop-master

  # ===============================
  # Zookeeper
  # ===============================
  zookeeper:
    image: confluentinc/cp-zookeeper:7.5.0
    container_name: zookeeper
    hostname: zookeeper
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
    networks:
      - hadoop
    ports:
      - "2181:2181"

  # ===============================
  # Kafka Broker
  # ===============================
  kafka:
    image: confluentinc/cp-kafka:7.5.0
    container_name: kafka
    hostname: kafka
    depends_on:
      - zookeeper
    networks:
      - hadoop
    ports:
      - "9092:9092"
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1

  # ===============================
  # Kafka UI
  # ===============================
  kafka-ui:
    image: provectuslabs/kafka-ui:latest
    container_name: kafka-ui
    hostname: kafka-ui
    depends_on:
      - kafka
    networks:
      - hadoop
    ports:
      - "8081:8080"   # Kafka UI Web Interface
    environment:
      - KAFKA_CLUSTERS_0_NAME=hadoop-kafka-cluster
      - KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=kafka:9092
      - KAFKA_CLUSTERS_0_ZOOKEEPER=zookeeper:2181

# ===============================
# Network Configuration
# ===============================
networks:
  hadoop:
    driver: bridge
